# Kvstore
Тестовое задание для разработчика Elixir

Tender.pro, 2017

На языке Elixir написать key-value хранилище с удалением данных по таймауту (TTL) и управлением (CRUD) через web. TTL задается при добавлении пары key-value в хранилище. Необходимо обезопасить приложение от потери данных между перезапусками.
Выполнив задание, отправьте нам ссылку на репозиторий с решением. При решении задачи не допускается создание форков с исходного репозитория

## Описание
В данном репозитории подготовелен каркас для тестового задания. Все зависимости, необходимые для решения задачи, в конфиг уже добавлены, изменение списка зависимостей не рекомендуется.
В директории lib есть набор пустых файлов, которые соискатель должен заполнить своим кодом. Если соискатель добавит дополнительные файлы в эту директорию, то потребуется аргументация этой необходимости. Не забываем про тесты и варнинги.

## Запуск
Запуск осуществляется стандартно: iex -S mix

## Описание реализации
Для долговременного хранения данных используется DETS.
При добавлении данных TTL заменяется на expiration time в секундах по системному времени.
При инициализации происходит удаление из таблицы всех устаревших записей.
В процессе работы создается структура индексации по expiration time, представляющая собой отсортированную коллекцию (`:gb_trees`), где ключом является expiration time, а значением - множество всех ключей (`MapSet`) с соответствующим expiration time.
В каждый момент времени существует таймер устанавливающийся по минимальному expiration time, при срабатывании которого удаляются соответствующие записи в таблице.

## Конфигурация
Доступные параметры конфигурации приложения:
  `db_file` - путь к файлу БД (по-умолчанию: "/tmp/kvstore.db")
  `api_endpoint` - PATH, по которому доступно API (по-уолчанию: "/api/v1/kvstore")
  `port` - TCP порт HTTP соединений (по-умолчанию: 8080)

## REST API
Поддерживаемые методы: GET, HEAD, POST, DELETE.

Данные должны быть в формате JSON (content-type: application/json).

Данные должны содердать поля:
  'key' : string()
  'value' : string()
  'ttl' : integer()

Пример добавления данных:
  `curl -X POST -H "Content-Type: application/json" -d '[{"key":"a", "value":"1", '"ttl":"60"},{"key":"b", "value":"2", "ttl":"80"}]' http://localhost:8080/api/v1/kvstore/`

Пример запроса всех данных:
  `curl -X GET http://localhost:8080/api/v1/kvstore/`

Пример запроса данных по ключу `a`:
  `curl -X GET http://localhost:8080/api/v1/kvstore/a`

Удаление данных аналогично запросу, только используется метод DELETE
 
## TODO:
  - Добавить поддержку "длинных" TTL (пока что размер ограничен параметрами `:erlang.start_timer`)
  - Добавить тесты
  - Добавить type-specs

License
-------

This project is under the **MIT** License. See the [LICENSE](LICENSE) file for the full license text.

Copyright (c) 2017 [Tender.Pro](http://www.tender.pro)
